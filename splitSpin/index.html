<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>SplitSpin</title>
        <link href="style.css" rel="stylesheet" type="text/css">
    </head>
<body>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" type='text/javascript'></script>
<script src='https://unpkg.com/spritespin@4.0.3/release/spritespin.js' type='text/javascript'></script>

<h1>SplitSpin View</h1>
<section>
    <div class="splitSpin">

        <div class="spin-wrap"  id="spin-wrap1">
            <div id="splitter"></div>
            <div id='spin1'></div>
        </div>   

        <div class="spin-wrap" id="spin-wrap2">
            <div id='spin2'></div>
        </div>

        <div class="overlay-loader">
            <div class="loader">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
             </div>
        </div>

    </div>

    <div class="monthSelector">
        <div class="custom-select">
            <select id="monthSelect1" data-spin-select="2">
                <option value="jan">Грудень</option>
                <option value="feb">Січень</option>
            </select>
        </div>
        
        <div class="custom-select">
            <select id="monthSelect2" data-spin-select="1">
                <option value="jan">Грудень</option>
                <option value="feb" selected="true">Січень</option>
            </select>
        </div>
    </div>

</section>
    
<script type='text/javascript'>
    var frameNumb = 0,
        splitSpin = document.querySelector(".splitSpin"),
        spin1 = $("#spin1"),
        spin2 = $("#spin2"),
        splitter = document.querySelector("#splitter");
        SPIN2 = document.querySelector("#spin-wrap2"),
        monthSelect1 = document.querySelector("#monthSelect1");
        monthSelect2 = document.querySelector("#monthSelect2"),
        loader = document.querySelector(".overlay-loader");

    var viewReady = false;

    spin1.spritespin({
        animate: false,
        source: SpriteSpin.sourceArray("./src/src1/DJI_000{frame}.jpg", {
            frame: [0, 84],
            digits: 2
        }),
        onLoad: function() {
            if(viewReady) {
                loader.style.display = "none";
            }
            viewReady = true
        },
        responsive: true,
    });
    var api1 = spin1.spritespin("api");
    
    spin2.spritespin({
        source: SpriteSpin.sourceArray("./src/src2/DJI_000{frame}.jpg", {
            frame: [0, 84],
            digits: 2
        }),
        onFrame: function(event,  args) {
            api1.data.frame = args.frame;
            frameNumb = args.frame;
            api1.updateFrame();
        },
        onLoad: function() {
            if(viewReady) {
                loader.style.display = "none";
            }
            viewReady = true;
        },
        loop: true,
        frameTime: 80,
        responsive: true,
    });
    var api2 = spin2.spritespin("api");

    var startX = 0,
        splitBlock = false;

    splitSpin.addEventListener('mouseup',function(e) {
        e.stopPropagation();
        api2.toggleAnimation(true);


        var currrentFrame = frameNumb;
        frameNumb > 107 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(0, !1)
        }) : frameNumb > 0 && frameNumb <= 10 ? setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(0, !1)
        }) : frameNumb > 10 && frameNumb <= 22 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(22, !1)
        }) : frameNumb > 22 && frameNumb <= 41 ? setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(22, !1)
        }) : frameNumb > 41 && frameNumb <= 52 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(52, !1)
        }) : frameNumb > 52 && frameNumb <= 61 ? setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(52, !1)
        }) : frameNumb > 61 && frameNumb <= 72 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(72, !1)
        }) : frameNumb > 72 && frameNumb <= 87 ? setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(72, !1)
        }) : frameNumb > 87 && frameNumb <= 103 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(103, !1)
        }) : frameNumb > 103 && frameNumb <= 107 && setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(103, !1)
        })
    });

    splitSpin.addEventListener('touchend', function(e) {
        e.stopPropagation();
        api2.toggleAnimation(true);
        
        var currrentFrame = frameNumb;
        frameNumb > 107 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(0, !1)
        }) : frameNumb > 0 && frameNumb <= 10 ? setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(0, !1)
        }) : frameNumb > 10 && frameNumb <= 22 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(22, !1)
        }) : frameNumb > 22 && frameNumb <= 41 ? setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(22, !1)
        }) : frameNumb > 41 && frameNumb <= 52 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(52, !1)
        }) : frameNumb > 52 && frameNumb <= 61 ? setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(52, !1)
        }) : frameNumb > 61 && frameNumb <= 72 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(72, !1)
        }) : frameNumb > 72 && frameNumb <= 87 ? setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(72, !1)
        }) : frameNumb > 87 && frameNumb <= 103 ? setTimeout(function() {
            api2.data.reverse = !1, api2.playTo(103, !1)
        }) : frameNumb > 103 && frameNumb <= 107 && setTimeout(function() {
            api2.data.reverse = !0, api2.playTo(103, !1)
        })
    });

    splitSpin.addEventListener('mousemove', function(e){
        e.stopImmediatePropagation();
        e.preventDefault();

        var leftY = splitSpin.getBoundingClientRect().left;
        
        var x = e.clientX;
        var x0 = e.currentTarget.getBoundingClientRect().left;
        splitter.style.left = x - leftY + "px";
        SPIN2.style.width = x - leftY + "px";
    });

    splitSpin.addEventListener('touchmove', function(e){
        e.stopImmediatePropagation();
        e.preventDefault();
        
        var x = e.changedTouches[0].clientX;
        var x0 = e.currentTarget.getBoundingClientRect().left;
        splitter.style.left = x + "px";
        SPIN2.style.width = x + "px";
    });
    
        spin1.unbind('touchmove');
        spin1.unbind('mousemove');
        
        spin2.unbind('touchmove');
        spin2.unbind('mousemove');

var x, i, j, selElmnt, a, b, c;
/*look for any elements with the class "custom-select":*/
x = document.getElementsByClassName("custom-select");
for (i = 0; i < x.length; i++) {
  selElmnt = x[i].getElementsByTagName("select")[0];
  /*for each element, create a new DIV that will act as the selected item:*/
  a = document.createElement("DIV");
  a.setAttribute("class", "select-selected");
  a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
  x[i].appendChild(a);
  /*for each element, create a new DIV that will contain the option list:*/
  b = document.createElement("DIV");
  b.setAttribute("class", "select-items select-hide");
  spinSelect = selElmnt.getAttribute('data-spin-select');
  b.setAttribute("data-spin-select", spinSelect);
  for (j = 0; j < selElmnt.length; j++) {
    /*for each option in the original select element,
    create a new DIV that will act as an option item:*/
    c = document.createElement("DIV");
    c.innerHTML = selElmnt.options[j].innerHTML;
    if(!!selElmnt.options[j].getAttribute('selected')) {
        a.innerHTML = selElmnt.options[j].innerHTML;
        console.log('ji');
    }
    c.addEventListener("click", function(e) {
        /*when an item is clicked, update the original select box,
        and the selected item:*/
        e.stopImmediatePropagation();
        e.preventDefault();
        var y, i, k, s, h;
        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
        h = this.parentNode.previousSibling;
        for (i = 0; i < s.length; i++) {
          if (s.options[i].innerHTML == this.innerHTML) {
            s.selectedIndex = i;
            h.innerHTML = this.innerHTML;
            y = this.parentNode.getElementsByClassName("same-as-selected");
            var spinSelect = "#spin" + this.parentNode.getAttribute("data-spin-select");
            for (k = 0; k < y.length; k++) {
              y[k].removeAttribute("class");
            }
            this.setAttribute("class", "same-as-selected");
            if("./src/"+this.innerHTML+"/DJI_00{frame}.jpg") {
                viewReady = false;
                $(spinSelect).spritespin({
                    source: SpriteSpin.sourceArray("./src/"+this.innerHTML+"/DJI_000{frame}.jpg", {
                        frame: [0, 84],
                        digits: 2
                    }),
                    onLoad: function() {
                        viewReady = true;
                        if(viewReady) {
                            loader.style.display = "none";
                        }
                    }
                });
                loader.style.display = "block";
            }
            break;
          }
        }
        h.click();
    });
    b.appendChild(c);
  }
  x[i].appendChild(b);
  a.addEventListener("click", function(e) {
      /*when the select box is clicked, close any other select boxes,
      and open/close the current select box:*/
      e.stopPropagation();
      closeAllSelect(this);
      this.nextSibling.classList.toggle("select-hide");
      this.classList.toggle("select-arrow-active");
  });
}
function closeAllSelect(elmnt) {
  /*a function that will close all select boxes in the document,
  except the current select box:*/
  var x, y, i, arrNo = [];
  x = document.getElementsByClassName("select-items");
  y = document.getElementsByClassName("select-selected");
  for (i = 0; i < y.length; i++) {
    if (elmnt == y[i]) {
      arrNo.push(i)
    } else {
      y[i].classList.remove("select-arrow-active");
    }
  }
  for (i = 0; i < x.length; i++) {
    if (arrNo.indexOf(i)) {
      x[i].classList.add("select-hide");
    }
  }
}
/*if the user clicks anywhere outside the select box,
then close all select boxes:*/
document.addEventListener("click", closeAllSelect); 
        
</script>
</body>
</html>


